<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SignupView Tests</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
      background: #f9f9f9;
    }
    h1 {
      color: #333;
      border-bottom: 2px solid #333;
      padding-bottom: 10px;
    }
    h2 {
      color: #555;
      margin-top: 30px;
    }
    .test-suite {
      background: white;
      padding: 15px;
      margin: 15px 0;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #results {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      white-space: pre-wrap;
      font-size: 12px;
      line-height: 1.5;
    }
    .summary {
      background: #e8f4f8;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
      font-weight: bold;
    }
    .pass { color: #28a745; }
    .fail { color: #dc3545; }
    .loading {
      color: #666;
      font-style: italic;
    }
    #visual-test {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>SignupView Component Tests</h1>
  
  <div class="test-suite">
    <h2>Automated Tests</h2>
    <div id="results" class="loading">Running tests...</div>
  </div>
  
  <div class="test-suite">
    <h2>Visual Test</h2>
    <p>This is a visual representation of the SignupView component:</p>
    <div id="visual-test"></div>
  </div>
  
  <script type="module">
    import { runTests } from './dist/test-exports.js';
    
    // Capture console output
    const originalLog = console.log;
    const originalError = console.error;
    let output = '';
    
    console.log = function(...args) {
      output += args.join(' ') + '\n';
      originalLog.apply(console, args);
    };
    
    console.error = function(...args) {
      output += args.join(' ') + '\n';
      originalError.apply(console, args);
    };
    
    // Run tests
    runTests().then(results => {
      const resultsDiv = document.getElementById('results');
      resultsDiv.className = '';
      resultsDiv.textContent = output;
      
      // Add summary
      const summary = document.createElement('div');
      summary.className = 'summary';
      summary.innerHTML = `
        <div>Total Tests: ${results.passed + results.failed}</div>
        <div class="pass">Passed: ${results.passed}</div>
        <div class="fail">Failed: ${results.failed}</div>
      `;
      resultsDiv.parentNode.insertBefore(summary, resultsDiv);
    }).catch(error => {
      const resultsDiv = document.getElementById('results');
      resultsDiv.className = 'fail';
      resultsDiv.textContent = 'Error running tests: ' + error.message;
    });
    
    // Restore console
    setTimeout(() => {
      console.log = originalLog;
      console.error = originalError;
    }, 100);
  </script>
  
  <script type="module">
    import { h, render } from './dist/bundle.js';
    import SignupView from './dist/bundle.js';
    
    // Create mock ATP client for visual test
    const mockClient = {
      createAccount: (options) => {
        console.log('Mock signup:', options);
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({
              accessJwt: 'mock-token',
              refreshJwt: 'mock-refresh',
              handle: options.handle,
              did: 'did:plc:mock',
              email: options.email
            });
          }, 1000);
        });
      },
      checkHandleAvailability: (handle) => {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({ available: handle !== 'taken' });
          }, 300);
        });
      },
      isValidEmail: (email) => {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      },
      isValidHandle: (handle) => {
        return /^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?)*$/.test(handle) 
          && handle.length >= 3 && handle.length <= 253;
      }
    };
    
    // Render visual test
    const visualTest = document.getElementById('visual-test');
    
    try {
      render(
        h(SignupView, {
          atpClient: mockClient,
          onSignup: (session) => {
            alert('Signup successful! Handle: ' + session.handle);
          },
          onNavigateToLogin: () => {
            alert('Navigate to login clicked');
          }
        }),
        visualTest
      );
    } catch (error) {
      visualTest.innerHTML = '<p style="color: red;">Error rendering component: ' + error.message + '</p>';
      console.error('Render error:', error);
    }
  </script>
</body>
</html>
